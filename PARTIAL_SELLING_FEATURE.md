# Ù…ÙŠØ²Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ - Partial Selling Feature

## ðŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙŠØ²Ø©

ØªØ³Ù…Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ø¨ÙŠØ¹ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¨ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©. Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„:
- Ø¹Ù„Ø¨Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 10 Ø¸Ø±ÙˆÙ
- ÙŠÙ…ÙƒÙ† Ø¨ÙŠØ¹ Ø¸Ø±Ù ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· (Ø£Ùˆ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø¸Ø±ÙˆÙ)
- Ø§Ù„Ø³Ø¹Ø± ÙŠÙØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© **20% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­**

---

## âœ… Ù…Ø§ ØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡

### 1. Entities
- âœ… `MasterProduct`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `PharmacyProduct`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `StockItem`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `remainingParts` (Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)
- âœ… `SaleInvoiceItem`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `partsSold` (Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©)

### 2. DTOs
- âœ… `MProductDTORequest`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `MProductDTOResponse`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `PharmacyProductDTORequest`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `PharmacyProductDTOResponse`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `SaleInvoiceItemDTORequest`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `partsToSell`

### 3. Mappers
- âœ… `MasterProductMapper`: ØªØ­Ø¯ÙŠØ« `toEntity()` Ùˆ `toResponse()`
- âœ… `PharmacyProductMapper`: ØªØ­Ø¯ÙŠØ« `toEntity()` Ùˆ `toResponse()`
- âœ… `StockItemMapper`: Ø£Ø¶ÙŠÙ method `getNumberOfPartsPerBox()`
- âœ… `SaleMapper`: ØªØ­Ø¯ÙŠØ« `toEntity()` Ù„Ø¯Ø¹Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ

### 4. SaleService
- âœ… ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ
- âœ… ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚ Ø®ØµÙ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
- âœ… Ø¥Ø¶Ø§ÙØ© validation Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© `partsToSell`

---

## ðŸ“ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ù…Ù„

### Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©:
```json
{
  "stockItemId": 1,
  "quantity": 2,  // Ø¹Ø¯Ø¯ Ø¹Ù„Ø¨
  "unitPrice": 800.0  // Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
}
```
- Ø§Ù„Ø³Ø¹Ø± = `unitPrice * quantity` = 800 * 2 = 1600
- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙØ®ØµÙ…: 2 Ø¹Ù„Ø¨

### Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø£Ø¬Ø²Ø§Ø¡ (3 Ø¸Ø±ÙˆÙ Ù…Ù† Ø¹Ù„Ø¨Ø© 10 Ø¸Ø±ÙˆÙ):
```json
{
  "stockItemId": 1,
  "quantity": 1,  // Ø¹Ø¯Ø¯ Ø¹Ù„Ø¨
  "partsToSell": 3,  // Ø¹Ø¯Ø¯ Ø£Ø¬Ø²Ø§Ø¡ (Ø¸Ø±ÙˆÙ)
  "unitPrice": 800.0,  // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø© (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ)
  "partPrice": null  // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø¥Ø°Ø§ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ØŒ Ø³ÙŠØ³ØªØ®Ø¯Ù… ÙƒØ³Ø¹Ø± Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
}
```

**Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØ±Ø³Ù„ partPrice):**
1. Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø© (`unitPrice` Ø£Ùˆ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†) = 800 SYP
2. Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ§Ø­Ø¯ (Ø¨Ø¯ÙˆÙ† Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­) = `800 / 10` = 80
3. Ø³Ø¹Ø± 3 Ø£Ø¬Ø²Ø§Ø¡ (Ù…Ø¹ 20% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­) = `80 * 3 * 1.20` = 288 SYP
4. Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: `remainingParts` ÙŠÙ†Ù‚Øµ Ù…Ù† 10 Ø¥Ù„Ù‰ 7 (Ù„Ù… ÙŠØªÙ… Ø®ØµÙ… Ø¹Ù„Ø¨Ø©)

**Ø¥Ø°Ø§ ØªÙ… ØªØ­Ø¯ÙŠØ¯ partPrice ÙŠØ¯ÙˆÙŠØ§Ù‹:**
```json
{
  "stockItemId": 1,
  "quantity": 1,
  "partsToSell": 3,
  "unitPrice": 800.0,  // Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø© (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØ±Ø³Ù„ partPrice)
  "partPrice": 100.0  // Ø§Ù„ØµÙŠØ¯Ù„Ø§Ù†ÙŠ Ø­Ø¯Ø¯ Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ§Ø­Ø¯ ÙŠØ¯ÙˆÙŠØ§Ù‹
}
```
- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: `100 * 3 = 300 SYP` (partPrice Ã— partsToSell)

### Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ 15 Ø¸Ø±ÙˆÙ (Ø¹Ù„Ø¨Ø© + 5 Ø¸Ø±ÙˆÙ):
```json
{
  "stockItemId": 1,
  "quantity": 2,  // Ø¹Ø¯Ø¯ Ø¹Ù„Ø¨
  "partsToSell": 5,  // 5 Ø¸Ø±ÙˆÙ Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
  "unitPrice": 800.0,  // Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø©
  "partPrice": null  // Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
}
```

**Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØ±Ø³Ù„ partPrice):**
1. Ø³Ø¹Ø± 5 Ø£Ø¬Ø²Ø§Ø¡ (Ù…Ø¹ 20% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­) = `(800/10) * 5 * 1.20` = 480 SYP
2. Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ÙŠØªÙ… Ø®ØµÙ… Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† `remainingParts` Ø­ØªÙ‰ ÙŠØµØ¨Ø­ 0ØŒ Ø«Ù… ÙŠÙØ®ØµÙ… Ø¹Ù„Ø¨Ø©

**Ù…Ù„Ø§Ø­Ø¸Ø©**: Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¹Ø¯Ø© Ø·Ù„Ø¨Ø§Øª Ø¨ÙŠØ¹ Ù…Ù†ÙØµÙ„Ø© Ø£Ùˆ Ù…Ù†Ø·Ù‚ Ø¥Ø¶Ø§ÙÙŠ Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† Ø¹Ù„Ø¨ Ù…ØªØ¹Ø¯Ø¯Ø©.

---

## ðŸ”‘ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‡Ù…Ø©

### 1. Ø­Ù‚Ù„ `numberOfPartsPerBox`
- **null Ø£Ùˆ 0 Ø£Ùˆ 1**: Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ø§ ÙŠØ¨Ø§Ø¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹ (Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø© ÙÙ‚Ø·)
- **> 1**: ÙŠÙ…ÙƒÙ† Ø¨ÙŠØ¹ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø© (Ù…Ø«Ù„: 10 Ø¸Ø±ÙˆÙ)

### 2. Ø­Ù‚Ù„ `partsToSell`
- **null**: ÙŠØ¨Ø§Ø¹ Ø§Ù„Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø© (quantity = Ø¹Ø¯Ø¯ Ø¹Ù„Ø¨)
- **> 0**: ÙŠØ¨Ø§Ø¹ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø©
- ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† `partsToSell <= numberOfPartsPerBox`

### 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±
- **Ø¨ÙŠØ¹ Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©**: 
  - Ø¥Ø°Ø§ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ `unitPrice`: ÙŠØ³ØªØ®Ø¯Ù… Ù…Ø¨Ø§Ø´Ø±Ø© ÙƒØ³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø©
  - Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØ±Ø³Ù„: ÙŠØ³ØªØ®Ø¯Ù… Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
- **Ø¨ÙŠØ¹ Ø¬Ø²Ø¦ÙŠ**: 
  - Ø¥Ø°Ø§ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ `partPrice`: ÙŠØ³ØªØ®Ø¯Ù… ÙƒØ³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ§Ø­Ø¯ØŒ ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ = `partPrice * partsToSell`
  - Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØ±Ø³Ù„ `partPrice`: ÙŠØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† `unitPrice` (Ø£Ùˆ Ø³Ø¹Ø± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†) Ù…Ø¹ 20% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­:
    - Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ§Ø­Ø¯ = `unitPrice / numberOfPartsPerBox`
    - Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ = `(unitPrice / numberOfPartsPerBox) * partsToSell * 1.20`

### 4. Ø®ØµÙ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙØ®Ø²Ù† Ø¨Ø§Ù„Ø¹Ù„Ø¨Ø© (`StockItem.quantity` = Ø¹Ø¯Ø¯ Ø¹Ù„Ø¨)
- ÙƒÙ„ Ø¹Ù„Ø¨Ø© Ù„Ø¯ÙŠÙ‡Ø§ `remainingParts` = Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
- Ø¹Ù†Ø¯ Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ:
  - ÙŠØªÙ… Ø®ØµÙ… Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† `remainingParts` Ù…Ø¨Ø§Ø´Ø±Ø©
  - **Ø¹Ù†Ø¯Ù…Ø§ `remainingParts` ÙŠØµØ¨Ø­ 0 Ø£Ùˆ Ø£Ù‚Ù„**: ÙŠØªÙ… Ø®ØµÙ… Ø¹Ù„Ø¨Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù† `quantity`
  - Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¹Ù„Ø¨Ø§Øª Ø£Ø®Ø±Ù‰: ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† `remainingParts = numberOfPartsPerBox` Ù„Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
- Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©: ÙŠØªÙ… Ø®ØµÙ… Ø¹Ù„Ø¨Ø© Ù…Ù† `quantity` Ù…Ø¨Ø§Ø´Ø±Ø©

### 5. Validation
- âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø¹Ø¯Ø¯ ÙƒØ§ÙÙ Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø§Øª
- âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† `partsToSell <= numberOfPartsPerBox`
- âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©

---

## ðŸ“Š Ù…Ø«Ø§Ù„ ÙƒØ§Ù…Ù„

### Ø§Ù„Ù…Ù†ØªØ¬:
- `numberOfPartsPerBox` = 10 (Ø¹Ù„Ø¨Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 10 Ø¸Ø±ÙˆÙ)
- `refSellingPrice` = 800 SYP (Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©)

### Ø¨ÙŠØ¹ 3 Ø¸Ø±ÙˆÙ:
**Request:**
```json
{
  "stockItemId": 1,
  "quantity": 1,
  "partsToSell": 3,
  "unitPrice": 800.0
}
```

**Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:**
1. Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ§Ø­Ø¯ = 800 / 10 = 80 SYP
2. Ø³Ø¹Ø± 3 Ø£Ø¬Ø²Ø§Ø¡ = 80 * 3 * 1.20 = 288 SYP
3. Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù‚Ø¨Ù„: 5 Ø¹Ù„Ø¨ØŒ `remainingParts` = 10 (Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù… ØªÙÙØªØ­ Ø¨Ø¹Ø¯)
4. Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹: `remainingParts` = 10 - 3 = 7 (Ù„Ø§ ØªØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ 7 Ø£Ø¬Ø²Ø§Ø¡ Ù…ØªØ¨Ù‚ÙŠØ©)
5. **Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø¹Ø¯: 5 Ø¹Ù„Ø¨ (Ù„Ù… ÙŠØªÙ… Ø®ØµÙ… Ø¹Ù„Ø¨Ø©)**ØŒ `remainingParts` = 7

**Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØ±Ø³Ù„ partPrice):**
- `unitPrice` ÙÙŠ SaleInvoiceItem = 288 SYP (Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
- `quantity` ÙÙŠ SaleInvoiceItem = 0 (Ù„Ù… ÙŠØªÙ… Ø®ØµÙ… Ø¹Ù„Ø¨Ø©)
- `partsSold` ÙÙŠ SaleInvoiceItem = 3
- `subTotal` = 288 SYP

**Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ø¥Ø°Ø§ Ø£ÙØ±Ø³Ù„ partPrice = 100):**
- `unitPrice` ÙÙŠ SaleInvoiceItem = 300 SYP (`partPrice * partsToSell` = 100 * 3)
- `quantity` ÙÙŠ SaleInvoiceItem = 0
- `partsSold` ÙÙŠ SaleInvoiceItem = 3
- `subTotal` = 300 SYP

**Ù…Ø«Ø§Ù„ Ø¢Ø®Ø±: Ø¨ÙŠØ¹ 7 Ø£Ø¬Ø²Ø§Ø¡ Ø£Ø®Ø±Ù‰ (Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø¹Ù„Ø¨Ø©):**
- Ù‚Ø¨Ù„ Ø§Ù„Ø¨ÙŠØ¹: `remainingParts` = 7
- Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹: `remainingParts` = 7 - 7 = 0
- **Ø§Ù„Ø¢Ù† ÙŠØªÙ… Ø®ØµÙ… Ø¹Ù„Ø¨Ø© ÙˆØ§Ø­Ø¯Ø©**: `quantity` = 5 - 1 = 4 Ø¹Ù„Ø¨
- Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¹Ù„Ø¨Ø§Øª Ø£Ø®Ø±Ù‰: `remainingParts` = 10 (Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©)

---

## âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

1. **Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ 20%** ÙŠÙØ¶Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ (Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ `partPrice` ÙŠØ¯ÙˆÙŠØ§Ù‹)
2. **ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± ÙŠØ¯ÙˆÙŠØ§Ù‹**: ÙŠÙ…ÙƒÙ† Ù„Ù„ØµÙŠØ¯Ù„Ø§Ù†ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ§Ø­Ø¯ ÙÙŠ Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ Ø¹Ø¨Ø± Ø­Ù‚Ù„ `partPrice`
3. **`unitPrice` vs `partPrice`**:
   - `unitPrice`: Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© (ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ)
   - `partPrice`: Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ§Ø­Ø¯ (Ø¥Ø°Ø§ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ØŒ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ = `partPrice * partsToSell`)
2. **Ù…Ù†Ø·Ù‚ Ø®ØµÙ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ**:
   - Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø£Ø¬Ø²Ø§Ø¡: ÙŠØªÙ… Ø®ØµÙ… Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† `remainingParts` ÙÙ‚Ø·
   - **Ø¹Ù†Ø¯Ù…Ø§ `remainingParts` ÙŠØµØ¨Ø­ 0 Ø£Ùˆ Ø£Ù‚Ù„**: ÙŠØªÙ… Ø®ØµÙ… Ø¹Ù„Ø¨Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù† `quantity` ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
   - Ù‡Ø°Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø¨ÙŠØ¹ Ø£Ø¬Ø²Ø§Ø¡ Ù…ØªØ¹Ø¯Ø¯Ø© Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø¹Ù„Ø¨Ø© Ø¯ÙˆÙ† Ø®ØµÙ… Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø© Ø­ØªÙ‰ ØªÙ†ÙØ¯ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡
3. **`partsToSell` Ø§Ø®ØªÙŠØ§Ø±ÙŠ**: Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØ±Ø³Ù„ØŒ ÙŠÙØ¹ØªØ¨Ø± Ø¨ÙŠØ¹ Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©
4. **`numberOfPartsPerBox` Ø§Ø®ØªÙŠØ§Ø±ÙŠ**: Ø¥Ø°Ø§ ÙƒØ§Ù† null Ø£Ùˆ <= 1ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ
5. **`remainingParts`**: ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ = `numberOfPartsPerBox` Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²ÙˆÙ† Ø¬Ø¯ÙŠØ¯

---

## ðŸ”„ Migration Script

ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ migration script ÙÙŠ: `src/main/resources/db/migration/V20251221_001__Add_Partial_Selling_Fields.sql`

**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚:**
- `V20251221_001__Add_Partial_Selling_Fields.sql`

**Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª:**
1. Ø¥Ø¶Ø§ÙØ© `number_of_parts_per_box` ÙÙŠ `master_product`
2. Ø¥Ø¶Ø§ÙØ© `number_of_parts_per_box` ÙÙŠ `pharmacy_product`
3. Ø¥Ø¶Ø§ÙØ© `remaining_parts` ÙÙŠ `stock_item`
4. Ø¥Ø¶Ø§ÙØ© `parts_sold` ÙÙŠ `sale_invoice_items`

**Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„migration:**

Ø¥Ø°Ø§ ÙƒØ§Ù† Flyway Ù…ÙØ¹Ù‘Ù„:
```bash
mvn flyway:migrate
```

Ø£Ùˆ ÙŠØ¯ÙˆÙŠØ§Ù‹:
```sql
-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ numberOfPartsPerBox
ALTER TABLE master_product ADD COLUMN IF NOT EXISTS number_of_parts_per_box INTEGER;
ALTER TABLE pharmacy_product ADD COLUMN IF NOT EXISTS number_of_parts_per_box INTEGER;

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ remainingParts ÙÙŠ StockItem
ALTER TABLE stock_item ADD COLUMN IF NOT EXISTS remaining_parts INTEGER;

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ partsSold ÙÙŠ SaleInvoiceItem
ALTER TABLE sale_invoice_items ADD COLUMN IF NOT EXISTS parts_sold INTEGER;
```

---

## âœ… Ø§Ù„Ø®Ù„Ø§ØµØ©

ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù…ÙŠØ²Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„:
- âœ… Entities Ùˆ DTOs Ù…Ø­Ø¯Ø«Ø© (Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ `remainingParts` Ùˆ `partsSold`)
- âœ… Mappers Ù…Ø­Ø¯Ø«Ø©
- âœ… Ù…Ù†Ø·Ù‚ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ø¹ 20% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­
- âœ… Ù…Ù†Ø·Ù‚ Ø®ØµÙ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ (ÙŠØ³ØªØ®Ø¯Ù… `remainingParts`)
- âœ… ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† ÙƒÙ„ Ø¹Ù„Ø¨Ø©
- âœ… Ø®ØµÙ… Ø¹Ù„Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯Ù…Ø§ ØªÙ†ÙØ¯ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ (`remainingParts = 0`)
- âœ… Validation Ø´Ø§Ù…Ù„

**Ø§Ù„Ù…ÙŠØ²Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…!** ðŸŽ‰

