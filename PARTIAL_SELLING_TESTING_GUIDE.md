# ุฏููู ุงุฎุชุจุงุฑ ููุฒุฉ ุงูุจูุน ุจุงูุฃุฌุฒุงุก - Partial Selling Testing Guide

## ๐ ููุฎุต ุงูุงุฎุชุจุงุฑุงุช

ูุฐุง ุงูุฏููู ูุบุทู ุฌููุน ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ ุงูููููุฉ ูููุฒุฉ ุงูุจูุน ุจุงูุฃุฌุฒุงุก.

---

## โ 1. ุงุฎุชุจุงุฑุงุช ุงูุญููู ุงูุฃุณุงุณูุฉ

### 1.1 ุงุฎุชุจุงุฑ `numberOfPartsPerBox`

#### โ ุงุฎุชุจุงุฑ ุฅุถุงูุฉ `numberOfPartsPerBox` ููููุชุฌ
- **ุงูุณููุงุฑูู**: ุฅูุดุงุก/ุชุญุฏูุซ ููุชุฌ ูุน `numberOfPartsPerBox`
- **ุงูุงุฎุชุจุงุฑ**:
  - ุฅูุดุงุก ููุชุฌ ุฌุฏูุฏ ูุน `numberOfPartsPerBox = 10`
  - ุงูุชุญูู ูู ุงูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - ุชุญุฏูุซ ููุชุฌ ููุฌูุฏ ูุฅุถุงูุฉ `numberOfPartsPerBox`
  - ุงูุชุญูู ูู ุงูุชุญุฏูุซ

#### โ ุงุฎุชุจุงุฑ ุงูููู ุงููุฎุชููุฉ
- `numberOfPartsPerBox = null` โ ูุฌุจ ุฃู ูุนูู (ูุง ูุจุงุน ุฌุฒุฆูุงู)
- `numberOfPartsPerBox = 0` โ ูุง ูุจุงุน ุฌุฒุฆูุงู
- `numberOfPartsPerBox = 1` โ ูุง ูุจุงุน ุฌุฒุฆูุงู
- `numberOfPartsPerBox = 2` โ ูุจุงุน ุฌุฒุฆูุงู โ
- `numberOfPartsPerBox = 10` โ ูุจุงุน ุฌุฒุฆูุงู โ
- `numberOfPartsPerBox = 100` โ ูุจุงุน ุฌุฒุฆูุงู โ

---

## โ 2. ุงุฎุชุจุงุฑุงุช ุฅุถุงูุฉ ุงููุฎุฒูู

### 2.1 ุงุฎุชุจุงุฑ `remainingParts` ุงูุชููุงุฆู
- **ุงูุณููุงุฑูู**: ุฅุถุงูุฉ ูุฎุฒูู ุฌุฏูุฏ ูููุชุฌ ูุฏูู `numberOfPartsPerBox > 1`
- **ุงูุงุฎุชุจุงุฑ**:
  - ุฅุถุงูุฉ 5 ุนูุจ ูููุชุฌ `numberOfPartsPerBox = 10`
  - ุงูุชุญูู ูู: `remainingParts = 10` (ููุนูุจุฉ ุงูุฃููู)
  - ุงูุชุญูู ูู: `quantity = 5` ุนูุจ

### 2.2 ุงุฎุชุจุงุฑ ููุชุฌ ุจุฏูู ุจูุน ุฌุฒุฆู
- **ุงูุณููุงุฑูู**: ุฅุถุงูุฉ ูุฎุฒูู ูููุชุฌ `numberOfPartsPerBox = null`
- **ุงูุงุฎุชุจุงุฑ**:
  - ุงูุชุญูู ูู: `remainingParts = null`

---

## โ 3. ุงุฎุชุจุงุฑุงุช ุงูุจูุน ุงูุฌุฒุฆู

### 3.1 ุจูุน ุฌุฒุก ูุงุญุฏ ููุท
**ุงูุณููุงุฑูู**: ุจูุน ุธุฑู ูุงุญุฏ ูู ุนูุจุฉ 10 ุธุฑูู

**Request:**
```json
{
  "stockItemId": 1,
  "quantity": 1,
  "partsToSell": 1,
  "unitPrice": 800.0
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- `remainingParts` ูููุต ูู 10 ุฅูู 9
- `quantity` ูุจูู 5 ุนูุจ (ูู ูุชู ุฎุตู ุนูุจุฉ)
- ุงูุณุนุฑ: `(800 / 10) * 1 * 1.20 = 96 SYP`

---

### 3.2 ุจูุน ุนุฏุฉ ุฃุฌุฒุงุก ูู ููุณ ุงูุนูุจุฉ
**ุงูุณููุงุฑูู**: ุจูุน 3 ุธุฑูู ูู ุนูุจุฉ 10 ุธุฑูู

**Request:**
```json
{
  "stockItemId": 1,
  "quantity": 1,
  "partsToSell": 3,
  "unitPrice": 800.0
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- `remainingParts` ูููุต ูู 10 ุฅูู 7
- `quantity` ูุจูู 5 ุนูุจ
- ุงูุณุนุฑ: `(800 / 10) * 3 * 1.20 = 288 SYP`
- `partsSold` ูู `SaleInvoiceItem` = 3

---

### 3.3 ุจูุน ูู ุงูุฃุฌุฒุงุก (ุงุณุชููุงุฏ ุงูุนูุจุฉ)
**ุงูุณููุงุฑูู**: ุจูุน 10 ุธุฑูู (ุนูุจุฉ ูุงููุฉ)

**Request:**
```json
{
  "stockItemId": 1,
  "quantity": 1,
  "partsToSell": 10,
  "unitPrice": 800.0
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- `remainingParts` ูุตุจุญ 0
- `quantity` ูููุต ูู 5 ุฅูู 4 ุนูุจ โ (ุชู ุฎุตู ุนูุจุฉ)
- ุฅุฐุง ูุงูุช ููุงู ุนูุจุงุช ุฃุฎุฑู: `remainingParts` ูุตุจุญ 10 (ุงูุนูุจุฉ ุงูุชุงููุฉ)

---

### 3.4 ุจูุน ุฃูุซุฑ ูู ุนูุจุฉ ูุงุญุฏุฉ (ุฃุฌุฒุงุก ูุชุนุฏุฏุฉ)
**ุงูุณููุงุฑูู**: ุจูุน 15 ุธุฑูู (ุนูุจุฉ + 5 ุธุฑูู)

**ุงูุฎุทูุงุช:**
1. **ุฃูู ุนูููุฉ ุจูุน: 10 ุธุฑูู**
   - `remainingParts`: 10 โ 0
   - `quantity`: 5 โ 4 ุนูุจ
   - `remainingParts` ุงูุฌุฏูุฏ: 10 (ุงูุนูุจุฉ ุงูุชุงููุฉ)

2. **ุซุงูู ุนูููุฉ ุจูุน: 5 ุธุฑูู**
   - `remainingParts`: 10 โ 5
   - `quantity`: 4 ุนูุจ (ูู ูุชุบูุฑ)

---

### 3.5 ุจูุน ูุน ุชุญุฏูุฏ `partPrice` ูุฏููุงู
**ุงูุณููุงุฑูู**: ุงูุตูุฏูุงูู ูุญุฏุฏ ุณุนุฑ ุงูุฌุฒุก ุงููุงุญุฏ ูุฏููุงู

**Request:**
```json
{
  "stockItemId": 1,
  "quantity": 1,
  "partsToSell": 3,
  "partPrice": 100.0
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- ุงูุณุนุฑ: `100 * 3 = 300 SYP` (ุจุฏูู ุญุณุงุจ ุชููุงุฆู)
- `remainingParts` ูููุต ูู 10 ุฅูู 7

---

### 3.6 ุจูุน ูุน ุชุญุฏูุฏ `unitPrice` ููุนูุจุฉ
**ุงูุณููุงุฑูู**: ุชุญุฏูุฏ ุณุนุฑ ุงูุนูุจุฉ ูุฏููุงู ููุญุณุงุจ ุงูุชููุงุฆู

**Request:**
```json
{
  "stockItemId": 1,
  "quantity": 1,
  "partsToSell": 3,
  "unitPrice": 1000.0
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- ุงูุณุนุฑ: `(1000 / 10) * 3 * 1.20 = 360 SYP`
- ูุณุชุฎุฏู `unitPrice` ุงููุญุฏุฏ ุจุฏูุงู ูู ุณุนุฑ ุงููุฎุฒูู

---

## โ 4. ุงุฎุชุจุงุฑุงุช Validation

### 4.1 ุงูุชุญูู ูู ุตุญุฉ `partsToSell`
- โ `partsToSell > numberOfPartsPerBox` โ ูุฌุจ ุฃู ูุนุทู ุฎุทุฃ
- โ `partsToSell <= numberOfPartsPerBox` โ ูุฌุจ ุฃู ูุนูู
- โ `partsToSell = null` ูุน ููุชุฌ ูุงุจู ููุจูุน ุงูุฌุฒุฆู โ ูุนุชุจุฑ ุจูุน ุนูุจุฉ ูุงููุฉ
- โ `partsToSell = 0` โ ุฎุทุฃ (ูุฌุจ ุฃู ูููู >= 1)

### 4.2 ุงูุชุญูู ูู ุชููุฑ ุงูุฃุฌุฒุงุก
- โ ุจูุน ุฃุฌุฒุงุก ุฃูุซุฑ ูู ุงููุชุงุญ โ ูุฌุจ ุฃู ูุนุทู ุฎุทุฃ "Insufficient parts"
- โ ุจูุน ุฃุฌุฒุงุก ูุชุงุญุฉ โ ูุฌุจ ุฃู ูุนูู

### 4.3 ุงุฎุชุจุงุฑ ููุชุฌ ุจุฏูู ุจูุน ุฌุฒุฆู
- โ ุฅุฑุณุงู `partsToSell` ูููุชุฌ `numberOfPartsPerBox = null` โ ูุนุชุจุฑ ุจูุน ุนูุจุฉ ูุงููุฉ
- โ ุฅุฑุณุงู `partsToSell` ูููุชุฌ `numberOfPartsPerBox = 1` โ ูุนุชุจุฑ ุจูุน ุนูุจุฉ ูุงููุฉ

---

## โ 5. ุงุฎุชุจุงุฑุงุช ุงูุณุนุฑ

### 5.1 ุญุณุงุจ ุงูุณุนุฑ ุงูุชููุงุฆู
- **ุงูุงุฎุชุจุงุฑ**: 
  - ุนูุจุฉ: 800 SYP
  - ุฃุฌุฒุงุก: 10
  - ุจูุน: 3 ุธุฑูู
  - **ุงูุณุนุฑ ุงููุชููุน**: `(800 / 10) * 3 * 1.20 = 288 SYP`

### 5.2 ุงูุณุนุฑ ุงููุฏูู (`partPrice`)
- **ุงูุงุฎุชุจุงุฑ**:
  - `partPrice = 100`, `partsToSell = 3`
  - **ุงูุณุนุฑ ุงููุชููุน**: `100 * 3 = 300 SYP`

### 5.3 ุงูุณุนุฑ ุจุฏูู ุชุญุฏูุฏ `unitPrice`
- **ุงูุงุฎุชุจุงุฑ**: ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ `unitPrice`ุ ูุณุชุฎุฏู ุณุนุฑ ุงูุจูุน ูู ุงููุฎุฒูู
- ุงูุชุญูู ูู ุงุณุชุฎุฏุงู `refSellingPrice` ูู ุงูููุชุฌ

---

## โ 6. ุงุฎุชุจุงุฑุงุช ุงููุฎุฒูู (`remainingParts`)

### 6.1 ุฎุตู ุงูุฃุฌุฒุงุก ุชุฏุฑูุฌูุงู
**ุงูุณูุณูุฉ:**
1. ุจูุน 3 ุธุฑูู โ `remainingParts`: 10 โ 7
2. ุจูุน 4 ุธุฑูู โ `remainingParts`: 7 โ 3
3. ุจูุน 3 ุธุฑูู โ `remainingParts`: 3 โ 0 โ ุฎุตู ุนูุจุฉ โ `remainingParts`: 10

### 6.2 ุงุณุชููุงุฏ ุนูุจุฉ ุซู ุงูุจุฏุก ุจุฃุฎุฑู
- ุจูุน 10 ุธุฑูู โ ุฎุตู ุนูุจุฉ โ `remainingParts` ูุนูุฏ ุฅูู 10

### 6.3 ุจูุน ุฃูุซุฑ ูู ุนูุจุฉ ูู ุนูููุฉ ูุงุญุฏุฉ
- ุฅุฐุง ูุงู `quantity = 3` ู `remainingParts = 5`
- ุจูุน 25 ุธุฑูู โ ูุญุชุงุฌ ุฅูู ููุทู ุฎุงุต (ูุฏ ูุญุชุงุฌ ุชุนุฏูู)

---

## โ 7. ุงุฎุชุจุงุฑุงุช ุจูุน ุนูุจุฉ ูุงููุฉ

### 7.1 ุจูุน ุนูุจุฉ ูุงููุฉ (ุจุฏูู `partsToSell`)
**Request:**
```json
{
  "stockItemId": 1,
  "quantity": 2
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- `partsSold = null`
- `quantity` ูููุต 2 ุนูุจ ูุจุงุดุฑุฉ
- ุฅุฐุง ูุงู ุงูููุชุฌ ูุงุจู ููุจูุน ุงูุฌุฒุฆู: `remainingParts = numberOfPartsPerBox` (ููุนูุจุฉ ุงูุชุงููุฉ)

### 7.2 ุจูุน ุนูุจุฉ ูุงููุฉ ูุน ุชุญุฏูุฏ `unitPrice`
- ุงูุณุนุฑ: `unitPrice * quantity`

---

## โ 8. ุงุฎุชุจุงุฑุงุช Edge Cases

### 8.1 ุจูุน 0 ุฃุฌุฒุงุก
- โ ูุฌุจ ุฃู ูุนุทู ุฎุทุฃ validation

### 8.2 ุจูุน ุฃุฌุฒุงุก ุฃูุซุฑ ูู ุงููุชุงุญ
- โ ูุฌุจ ุฃู ูุนุทู ุฎุทุฃ "Insufficient parts"

### 8.3 `numberOfPartsPerBox` ูุจูุฑ ุฌุฏุงู
- โ ูุฌุจ ุฃู ูุนูู ูุน ุฃู ูููุฉ (ูุซู 1000)

### 8.4 `partsToSell` ูุณุงูู `numberOfPartsPerBox` ุจุงูุถุจุท
- โ ูุฌุจ ุฃู ูุณุชููุฏ ุงูุนูุจุฉ ููุฎุตู ุนูุจุฉ

---

## โ 9. ุงุฎุชุจุงุฑุงุช Integration

### 9.1 ุงุฎุชุจุงุฑ ูุน Currency Conversion
- ุจูุน ุฃุฌุฒุงุก ุจุนููุฉ ูุฎุชููุฉ (USD, EUR)
- ุงูุชุญูู ูู ุชุญููู ุงูุณุนุฑ ุจุดูู ุตุญูุญ

### 9.2 ุงุฎุชุจุงุฑ ูุน Discounts
- ุจูุน ุฃุฌุฒุงุก ูุน ุฎุตู ุนูู ุงููุงุชูุฑุฉ
- ุงูุชุญูู ูู ุชุทุจูู ุงูุฎุตู ุนูู ุงูุณุนุฑ ุงูุตุญูุญ

### 9.3 ุงุฎุชุจุงุฑ ูุน Refunds
- ุฅุฑุฌุงุน ุฌุฒุก ูู ุงูุจูุน
- ุงูุชุญูู ูู ุฅุนุงุฏุฉ ุงูุฃุฌุฒุงุก ุฅูู `remainingParts`

---

## โ 10. ุงุฎุชุจุงุฑุงุช API (Swagger)

### 10.1 Full Sale Invoice ูุน Partial Selling
**Request:**
```json
{
  "customerId": 1,
  "paymentType": "CASH",
  "currency": "SYP",
  "items": [
    {
      "stockItemId": 1,
      "quantity": 1,
      "partsToSell": 3,
      "unitPrice": 800.0
    },
    {
      "stockItemId": 2,
      "quantity": 2
    }
  ]
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- ุงูุนูุตุฑ ุงูุฃูู: ุจูุน ุฌุฒุฆู (3 ุธุฑูู)
- ุงูุนูุตุฑ ุงูุซุงูู: ุจูุน ุนูุจุฉ ูุงููุฉ
- `subTotal` ุตุญูุญ ููู ุนูุตุฑ

---

## โ 11. ุงุฎุชุจุงุฑุงุช Database

### 11.1 ุงูุชุญูู ูู Migration
- ุงูุชุญูู ูู ูุฌูุฏ ุงูุฃุนูุฏุฉ:
  - `master_product.number_of_parts_per_box`
  - `pharmacy_product.number_of_parts_per_box`
  - `stock_item.remaining_parts`
  - `sale_invoice_items.parts_sold`

### 11.2 ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุญููุธุฉ
- ุจุนุฏ ุงูุจูุน ุงูุฌุฒุฆูุ ุงูุชุญูู ูู:
  - `StockItem.remainingParts` ูุญุฏุซ ุจุดูู ุตุญูุญ
  - `SaleInvoiceItem.partsSold` ูุญููุธ ุจุดูู ุตุญูุญ

---

## โ 12. ุงุฎุชุจุงุฑุงุช Performance

### 12.1 ุจูุน ูููุงุช ูุจูุฑุฉ
- ุจูุน 1000 ุฌุฒุก ูู ุนูููุฉ ูุงุญุฏุฉ
- ุงูุชุญูู ูู ุงูุฃุฏุงุก

### 12.2 ุนูููุงุช ุจูุน ูุชุนุฏุฏุฉ ูุชุชุงููุฉ
- ุณูุณูุฉ ูู ุนูููุงุช ุงูุจูุน ุงูุฌุฒุฆู
- ุงูุชุญูู ูู ุฏูุฉ `remainingParts`

---

## ๐ Checklist ููุงุฎุชุจุงุฑ ุงูุณุฑูุน

- [ ] ุฅุถุงูุฉ `numberOfPartsPerBox` ููููุชุฌ
- [ ] ุฅุถุงูุฉ ูุฎุฒูู ูุงูุชุญูู ูู `remainingParts = numberOfPartsPerBox`
- [ ] ุจูุน ุฌุฒุก ูุงุญุฏ ูุงูุชุญูู ูู `remainingParts` ูููุต
- [ ] ุจูุน ูู ุงูุฃุฌุฒุงุก ูุงูุชุญูู ูู ุฎุตู ุนูุจุฉ
- [ ] ุจูุน ูุน `partPrice` ูุฏููุงู
- [ ] ุจูุน ุนูุจุฉ ูุงููุฉ (ุจุฏูู `partsToSell`)
- [ ] ุงูุชุญูู ูู ุญุณุงุจ ุงูุณุนุฑ ุงูุตุญูุญ (ูุน 20% ุฑุจุญ)
- [ ] ุงุฎุชุจุงุฑ validation (partsToSell > numberOfPartsPerBox)
- [ ] ุงุฎุชุจุงุฑ Insufficient parts
- [ ] ุงุฎุชุจุงุฑ ูุน Currency Conversion

---

## ๐ฏ ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ ุงููููุฉ

### ุงูุณููุงุฑูู 1: ุงูุตูุฏูู ูุจูุน ุธุฑู ูุงุญุฏ
1. ุงูููุชุฌ: ุนูุจุฉ 10 ุธุฑููุ ุณุนุฑ 800 SYP
2. ุงููุฎุฒูู: 5 ุนูุจุ `remainingParts = 10`
3. ุงูุจูุน: 1 ุธุฑู
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - `remainingParts`: 10 โ 9
   - `quantity`: 5 ุนูุจ (ูู ูุชุบูุฑ)
   - ุงูุณุนุฑ: 96 SYP

### ุงูุณููุงุฑูู 2: ุงุณุชููุงุฏ ุนูุจุฉ ุซู ุจูุน ูู ุฃุฎุฑู
1. ุงูููุชุฌ: ุนูุจุฉ 10 ุธุฑูู
2. ุงููุฎุฒูู: 2 ุนูุจุ `remainingParts = 3` (3 ุธุฑูู ูุชุจููุฉ ูู ุนูุจุฉ)
3. ุงูุจูุน: 5 ุธุฑูู
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - `remainingParts`: 3 โ 0 โ ุฎุตู ุนูุจุฉ โ `remainingParts`: 10
   - `quantity`: 2 โ 1 ุนูุจุฉ
   - ุจูุน 5 ูู 10 ูุชุจููุฉ: `remainingParts`: 10 โ 5
   - **ุงูุฅุฌูุงูู**: `quantity = 1`, `remainingParts = 5`

### ุงูุณููุงุฑูู 3: ุชุญุฏูุฏ ุงูุณุนุฑ ูุฏููุงู
1. ุงูููุชุฌ: ุนูุจุฉ 10 ุธุฑููุ ุณุนุฑ 800 SYP
2. ุงูุจูุน: 3 ุธุฑููุ `partPrice = 120` (ุจุฏูุงู ูู ุงูุญุณุงุจ ุงูุชููุงุฆู)
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - ุงูุณุนุฑ: `120 * 3 = 360 SYP` (ุจุฏูุงู ูู 288 SYP ุงูุชููุงุฆู)

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ ููุงุฎุชุจุงุฑ

1. **ูุงูุด ุงูุฑุจุญ 20%** ููุถุงู ููุท ุนูุฏ ุงูุญุณุงุจ ุงูุชููุงุฆู (ููุณ ูุน `partPrice` ุงููุฏูู)
2. **`remainingParts`** ูุชู ุชุญุฏูุซู ุชููุงุฆูุงู ุนูุฏ ุงูุจูุน ุงูุฌุฒุฆู
3. **ุนูุฏูุง `remainingParts = 0`**: ูุชู ุฎุตู ุนูุจุฉ ุชููุงุฆูุงู
4. **`partsSold`** ููุญูุธ ูู `SaleInvoiceItem` ูุชุชุจุน ูุง ุชู ุจูุนู

---

## ๐ ููููุฉ ุงูุชุญูู ูู ุงููุชุงุฆุฌ

### ูู Database:
```sql
-- ุงูุชุญูู ูู remainingParts
SELECT id, quantity, remaining_parts 
FROM stock_item 
WHERE product_id = 1;

-- ุงูุชุญูู ูู partsSold ูู ุงููุงุชูุฑุฉ
SELECT id, quantity, parts_sold, unit_price, sub_total 
FROM sale_invoice_items 
WHERE sale_invoice_id = 123;
```

### ูู API Response:
- ุงูุชุญูู ูู `subTotal` ูู `SaleInvoiceItem`
- ุงูุชุญูู ูู `totalAmount` ูู `SaleInvoice`

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ููุณุงุนุฏุฉ ูุฑูู QA ูุงูุงุฎุชุจุงุฑ!** ๐ฏ

