# Ù…ÙŠØ²Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ - Partial Selling Implementation

## ðŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙŠØ²Ø©

ØªØ³Ù…Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ø¨ÙŠØ¹ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¨ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©. Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„:
- Ø¹Ù„Ø¨Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 10 Ø¸Ø±ÙˆÙ
- ÙŠÙ…ÙƒÙ† Ø¨ÙŠØ¹ Ø¸Ø±Ù ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· (Ø£Ùˆ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø¸Ø±ÙˆÙ)
- Ø§Ù„Ø³Ø¹Ø± ÙŠÙØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© 20% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­

---

## âœ… Ù…Ø§ ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†

### 1. Entities
- âœ… `MasterProduct`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `PharmacyProduct`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`

### 2. DTOs
- âœ… `MProductDTORequest`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `MProductDTOResponse`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `PharmacyProductDTORequest`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `PharmacyProductDTOResponse`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `numberOfPartsPerBox`
- âœ… `SaleInvoiceItemDTORequest`: Ø£Ø¶ÙŠÙ Ø­Ù‚Ù„ `partsToSell`

---

## ðŸ”¨ Ù…Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥ØªÙ…Ø§Ù…

### 1. ØªØ­Ø¯ÙŠØ« Mappers
- [ ] `MasterProductMapper.toEntity()`: ØªØ­ÙˆÙŠÙ„ `numberOfPartsPerBox` Ù…Ù† DTO Ø¥Ù„Ù‰ Entity
- [ ] `MasterProductMapper.toResponse()`: ØªØ­ÙˆÙŠÙ„ `numberOfPartsPerBox` Ù…Ù† Entity Ø¥Ù„Ù‰ DTO
- [ ] `PharmacyProductMapper.toEntity()`: ØªØ­ÙˆÙŠÙ„ `numberOfPartsPerBox` Ù…Ù† DTO Ø¥Ù„Ù‰ Entity
- [ ] `PharmacyProductMapper.toResponse()`: ØªØ­ÙˆÙŠÙ„ `numberOfPartsPerBox` Ù…Ù† Entity Ø¥Ù„Ù‰ DTO

### 2. ØªØ­Ø¯ÙŠØ« SaleService
- [ ] Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ:
  - Ø¥Ø°Ø§ ÙƒØ§Ù† `partsToSell` != null Ùˆ `numberOfPartsPerBox` > 1
  - Ø§Ù„Ø³Ø¹Ø± = (Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø© / numberOfPartsPerBox) * partsToSell * 1.20 (20% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­)
  
- [ ] Ø®ØµÙ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:
  - Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨ÙŠØ¹ Ø¬Ø²Ø¦ÙŠ: Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ `partsToSell`
  - Ù…Ø«Ø§Ù„: Ø¥Ø°Ø§ ÙƒØ§Ù† `partsToSell = 3` Ùˆ `numberOfPartsPerBox = 10` â†’ Ù†Ø­ØªØ§Ø¬ 1 Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©
  - **Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©**: Ø­Ø³Ø¨ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙØ®Ø²Ù† Ø¨Ø§Ù„Ø¹Ù„Ø¨Ø© Ù„ÙƒÙ† ÙŠÙØ®ØµÙ… Ø¨Ø§Ù„Ø¬Ø²Ø¡

- [ ] Validation:
  - Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù†ØªØ¬ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ (`numberOfPartsPerBox` > 1)
  - Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† `partsToSell` <= `numberOfPartsPerBox` * `quantity`
  - Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆÙØ± Ø¹Ø¯Ø¯ ÙƒØ§ÙÙ Ù…Ù† Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†

### 3. Database Migration
- [ ] Ø¥Ù†Ø´Ø§Ø¡ migration script Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ `number_of_parts_per_box` ÙÙŠ:
  - `master_product` table
  - `pharmacy_product` table

---

## ðŸ“ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ù…Ù„

### Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©:
```json
{
  "stockItemId": 1,
  "quantity": 2,  // Ø¹Ø¯Ø¯ Ø¹Ù„Ø¨
  "unitPrice": 800.0
}
```
- Ø§Ù„Ø³Ø¹Ø± = `unitPrice * quantity` = 800 * 2 = 1600
- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙØ®ØµÙ…: 2 Ø¹Ù„Ø¨

### Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø£Ø¬Ø²Ø§Ø¡:
```json
{
  "stockItemId": 1,
  "quantity": 1,  // Ø¹Ø¯Ø¯ Ø¹Ù„Ø¨
  "partsToSell": 3,  // Ø¹Ø¯Ø¯ Ø£Ø¬Ø²Ø§Ø¡ (Ø¸Ø±ÙˆÙ)
  "unitPrice": 800.0  // Ø³Ø¹Ø± Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
}
```

**Ø§Ù„Ø­Ø³Ø§Ø¨:**
- Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ§Ø­Ø¯ (Ø¨Ø¯ÙˆÙ† Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­) = `800 / 10` = 80
- Ø³Ø¹Ø± 3 Ø£Ø¬Ø²Ø§Ø¡ (Ù…Ø¹ 20% Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­) = `80 * 3 * 1.20` = 288
- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙØ®ØµÙ…: 1 Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø© (Ù„Ø£Ù† 3 Ø¸Ø±ÙˆÙ < 10 Ø¸Ø±ÙˆÙ)

**Ø¥Ø°Ø§ Ø¨ÙŠØ¹ 15 Ø¸Ø±ÙˆÙ:**
- `quantity = 2` (Ø¹Ù„Ø¨ØªÙŠÙ†)
- `partsToSell = 5` (5 Ø¸Ø±ÙˆÙ Ù…Ù† Ø§Ù„Ø¹Ù„Ø¨Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©)
- Ø§Ù„Ø³Ø¹Ø± = (800/10) * 5 * 1.20 = 480
- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙØ®ØµÙ…: 2 Ø¹Ù„Ø¨ ÙƒØ§Ù…Ù„Ø©

---

## âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

1. **Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙØ®Ø²Ù† Ø¨Ø§Ù„Ø¹Ù„Ø¨Ø©**: `StockItem.quantity` ÙŠÙ…Ø«Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø¨Ø§Øª
2. **Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ÙŠÙƒÙˆÙ† Ø¨Ø§Ù„Ø¬Ø²Ø¡**: Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø¬Ø²Ø¡ØŒ Ù†Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆÙŽÙ†ÙŽØ®ØµÙ… Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©
3. **Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ 20%**: ÙŠÙØ¶Ø§Ù ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø¬Ø²Ø¡ (Ù„ÙŠØ³ Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø©)
4. **Ø¥Ø°Ø§ `numberOfPartsPerBox` = null Ø£Ùˆ 0 Ø£Ùˆ 1**: Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ø§ ÙŠØ¨Ø§Ø¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹ (Ø¹Ù„Ø¨Ø© ÙƒØ§Ù…Ù„Ø© ÙÙ‚Ø·)

---

## ðŸŽ¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©

1. ØªØ­Ø¯ÙŠØ« Mappers
2. ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨ÙŠØ¹ ÙÙŠ SaleService
3. Ø¥Ø¶Ø§ÙØ© Validation
4. Ø¥Ù†Ø´Ø§Ø¡ Migration Script
5. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ÙŠØ²Ø©

